"use strict";(self.webpackChunkmini_program=self.webpackChunkmini_program||[]).push([[42],{2042:(tn,f,u)=>{u.r(f),u.d(f,{LoginModule:()=>nn});var h=u(8583),s=u(665),n=u(7716),b=u(9075),v=u(8058),T=u(4655),x=u(1841);let F=(()=>{class o{constructor(t){this.http=t}sendSmsCode(t){return this.http.post("/api/sms/send",{phone:t})}loginWithSms(t){return this.http.post("/api/login/sms",t)}login(t){return this.http.post("/api/login",t)}register(t){return this.http.post("/api/register",t)}}return o.\u0275fac=function(t){return new(t||o)(n.LFG(x.eN))},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var a=u(1398),c=u(5887),C=u(6704),m=u(7674),A=u(4514),z=u(4453),y=u(9374),B=u(1594),p=u(8542);function I(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u7528\u6237\u540d "),n.BQk())}function L(o,r){1&o&&n.YNc(0,I,2,0,"ng-container",29),2&o&&n.Q6J("ngIf",r.$implicit.hasError("required"))}function E(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u5bc6\u7801 "),n.BQk())}function J(o,r){1&o&&n.YNc(0,E,2,0,"ng-container",29),2&o&&n.Q6J("ngIf",r.$implicit.hasError("required"))}function Q(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u624b\u673a\u53f7 "),n.BQk())}function k(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u683c\u5f0f "),n.BQk())}function q(o,r){if(1&o&&(n.YNc(0,Q,2,0,"ng-container",29),n.YNc(1,k,2,0,"ng-container",29)),2&o){const t=r.$implicit;n.Q6J("ngIf",t.hasError("required")),n.xp6(1),n.Q6J("ngIf",t.hasError("pattern"))}}function N(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801 "),n.BQk())}function M(o,r){1&o&&n.YNc(0,N,2,0,"ng-container",29),2&o&&n.Q6J("ngIf",r.$implicit.hasError("required"))}function S(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u7528\u6237\u540d "),n.BQk())}function w(o,r){1&o&&n.YNc(0,S,2,0,"ng-container",29),2&o&&n.Q6J("ngIf",r.$implicit.hasError("required"))}function O(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u5bc6\u7801 "),n.BQk())}function U(o,r){1&o&&n.YNc(0,O,2,0,"ng-container",29),2&o&&n.Q6J("ngIf",r.$implicit.hasError("required"))}function Y(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u786e\u8ba4\u5bc6\u7801 "),n.BQk())}function P(o,r){1&o&&(n.ynx(0),n._uU(1," \u4e24\u6b21\u5bc6\u7801\u8f93\u5165\u4e0d\u4e00\u81f4 "),n.BQk())}function D(o,r){if(1&o&&(n.YNc(0,Y,2,0,"ng-container",29),n.YNc(1,P,2,0,"ng-container",29)),2&o){const t=r.$implicit;n.Q6J("ngIf",t.hasError("required")),n.xp6(1),n.Q6J("ngIf",t.hasError("notSame"))}}function W(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u624b\u673a\u53f7 "),n.BQk())}function V(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u683c\u5f0f "),n.BQk())}function $(o,r){if(1&o&&(n.YNc(0,W,2,0,"ng-container",29),n.YNc(1,V,2,0,"ng-container",29)),2&o){const t=r.$implicit;n.Q6J("ngIf",t.hasError("required")),n.xp6(1),n.Q6J("ngIf",t.hasError("pattern"))}}function G(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"form",30),n.TgZ(2,"nz-form-item"),n.TgZ(3,"nz-form-control",7),n.TgZ(4,"nz-input-group",8),n._UZ(5,"input",9),n.qZA(),n.YNc(6,w,1,1,"ng-template",null,31,n.W1O),n.qZA(),n.qZA(),n.TgZ(8,"nz-form-item"),n.TgZ(9,"nz-form-control",7),n.TgZ(10,"nz-input-group",11),n._UZ(11,"input",12),n.qZA(),n.YNc(12,U,1,1,"ng-template",null,32,n.W1O),n.qZA(),n.qZA(),n.TgZ(14,"nz-form-item"),n.TgZ(15,"nz-form-control",7),n.TgZ(16,"nz-input-group",33),n._UZ(17,"input",34),n.qZA(),n.YNc(18,D,2,2,"ng-template",null,35,n.W1O),n.qZA(),n.qZA(),n.TgZ(20,"nz-form-item"),n.TgZ(21,"nz-form-control",7),n.TgZ(22,"nz-input-group",15),n._UZ(23,"input",16),n.qZA(),n.YNc(24,$,2,2,"ng-template",null,17,n.W1O),n.qZA(),n.qZA(),n.qZA(),n.BQk()),2&o){const t=n.MAs(7),e=n.MAs(13),i=n.MAs(19),g=n.MAs(25),l=n.oxw();n.xp6(1),n.Q6J("formGroup",l.registerIfy.registerForm),n.xp6(2),n.Q6J("nzErrorTip",t),n.xp6(6),n.Q6J("nzErrorTip",e),n.xp6(6),n.Q6J("nzErrorTip",i),n.xp6(6),n.Q6J("nzErrorTip",g)}}function j(o,r){if(1&o){const t=n.EpF();n.TgZ(0,"button",36),n.NdJ("click",function(){return n.CHM(t),n.oxw().registerIfy.close()}),n._uU(1,"\u53d6\u6d88"),n.qZA(),n.TgZ(2,"button",37),n.NdJ("click",function(){return n.CHM(t),n.oxw().registerIfy.save()}),n._uU(3," \u6ce8\u518c "),n.qZA()}if(2&o){const t=n.oxw();n.xp6(2),n.Q6J("disabled",!t.registerIfy.registerForm.valid)}}let H=(()=>{class o{constructor(t,e,i,g,l){this.fb=t,this.titleService=e,this.message=i,this.router=g,this.loginService=l,this.countdown=0,this.loginType="account",this.loading=!1,this.loadingText="\u767b\u5f55\u4e2d...",this.registerIfy={visible:!1,title:"\u7528\u6237\u6ce8\u518c",registerForm:this.fb.group({username:["",s.kI.required],password:["",s.kI.required],phone:["",[s.kI.required,s.kI.pattern(/^1[3-9]\d{9}$/)]],confirmPassword:["",[s.kI.required,this.passwordMatchValidator]]}),open:()=>{this.registerIfy.visible=!0,this.loadingText="\u6ce8\u518c\u4e2d...",this.registerIfy.registerForm.reset({})},close:()=>{this.loadingText="\u767b\u5f55\u4e2d...",this.registerIfy.visible=!1},save:()=>{if(this.registerIfy.registerForm.valid){this.loading=!0;const{username:_,password:d,phone:on}=this.registerIfy.registerForm.value;this.loginService.register({username:_,password:d,phone:on}).subscribe(Z=>{this.loading=!1,Z.success?this.registerIfy.close():this.message.error(Z.message)})}}},this.loginForm=this.fb.group({username:["",s.kI.required],password:["",s.kI.required]}),this.smsLoginForm=this.fb.group({phone:["",[s.kI.required,s.kI.pattern(/^1[3-9]\d{9}$/)]],smsCode:["",s.kI.required]})}sendSmsCode(){var t,e;const i="sms"===this.loginType?null===(t=this.smsLoginForm.get("phone"))||void 0===t?void 0:t.value:null===(e=this.loginForm.get("phone"))||void 0===e?void 0:e.value;i?this.loginService.sendSmsCode(i).subscribe({next:g=>{g.success?this.startCountdown():this.message.error(g.message||"\u9a8c\u8bc1\u7801\u53d1\u9001\u5931\u8d25")},error:g=>{this.message.error("\u9a8c\u8bc1\u7801\u53d1\u9001\u5931\u8d25")}}):this.message.error("\u8bf7\u8f93\u5165\u624b\u673a\u53f7")}onSmsSubmit(){if(this.smsLoginForm.invalid)return;const{phone:t,smsCode:e}=this.smsLoginForm.value;this.loading=!0,this.loginService.loginWithSms({phone:t,code:e}).subscribe({next:i=>{this.loading=!1,i.success?(localStorage.setItem("token",i.token),this.router.navigate(["/welcome"]).then(g=>{g||console.error("\u5bfc\u822a\u5230/welcome\u5931\u8d25")})):this.message.error(i.message||"\u767b\u5f55\u5931\u8d25")},error:i=>{this.loading=!1,this.message.error("\u767b\u5f55\u5931\u8d25")}})}startCountdown(){this.countdown=60,this.countdownInterval=setInterval(()=>{this.countdown--,this.countdown<=0&&clearInterval(this.countdownInterval)},1e3)}ngOnDestroy(){this.countdownInterval&&clearInterval(this.countdownInterval)}passwordMatchValidator(t){var e,i;return(null===(i=null===(e=t.parent)||void 0===e?void 0:e.get("password"))||void 0===i?void 0:i.value)===t.value?null:{notSame:!0}}onSubmit(){if(this.loading=!0,this.loginForm.valid){const t=this.loginForm.getRawValue();this.loginService.login(t).subscribe(e=>{this.loading=!1,e.success?(localStorage.setItem("token",e.token),this.router.navigate(["/welcome"]).then(i=>{i||console.error("\u5bfc\u822a\u5230/welcome\u5931\u8d25")})):this.message.error(e.message)})}}guestLogin(){this.loading=!0,this.loadingText="\u6b63\u5728\u8fdb\u5165\u6e38\u5ba2\u6a21\u5f0f...",localStorage.setItem("token","guest"),localStorage.setItem("userInfo",JSON.stringify({username:"\u6e38\u5ba2",role:"guest"})),localStorage.setItem("isGuest","true"),this.router.navigate(["/welcome"])}ngOnInit(){this.titleService.setTitle("\u767b\u5f55\u9875\u9762-\u6b22\u8fce\u8bbf\u95ee")}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(s.qu),n.Y36(b.Dx),n.Y36(v.dD),n.Y36(T.F0),n.Y36(F))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-login"]],decls:50,vars:18,consts:[[1,"login-container"],[1,"login-title"],[2,"margin-bottom","20px",3,"ngModel","ngModelChange"],["nz-radio-button","","nzValue","account"],["nz-radio-button","","nzValue","sms"],[1,"login-form"],["nz-form","",3,"formGroup","hidden","ngSubmit"],[3,"nzErrorTip"],["nzPrefixIcon","user"],["type","text","nz-input","","formControlName","username","placeholder","\u7528\u6237\u540d"],["usernameErrorTpl",""],["nzPrefixIcon","lock"],["type","password","nz-input","","formControlName","password","placeholder","\u5bc6\u7801"],["passwordErrorTpl",""],["nz-button","","nzType","primary","nzBlock","",1,"login-button",2,"height","40px","font-size","16px",3,"disabled"],["nzPrefixIcon","mobile"],["type","text","nz-input","","formControlName","phone","placeholder","\u624b\u673a\u53f7"],["phoneErrorTpl",""],["nzPrefixIcon","message"],["type","text","nz-input","","formControlName","smsCode","placeholder","\u77ed\u4fe1\u9a8c\u8bc1\u7801"],["nz-button","","nzType","primary",2,"width","100px",3,"disabled","click"],["smsErrorTpl",""],["nz-button","","nzType","primary","nzBlock","",1,"login-button",3,"disabled"],["nz-button","","nzType","default","nzBlock","",1,"login-button",2,"margin-top","16px","height","40px","font-size","16px",3,"click"],["nz-button","","nzType","dashed","nzBlock","",1,"guest-login-button",2,"margin-top","10px",3,"click"],[3,"loading","loadingText"],[3,"nzVisible","nzTitle","nzFooter","nzVisibleChange","nzOnCancel"],[4,"nzModalContent"],["modalFooter",""],[4,"ngIf"],["nz-form","",3,"formGroup"],["registerUsernameError",""],["registerPasswordError",""],["nzPrefixIcon","safety"],["type","password","nz-input","","formControlName","confirmPassword","placeholder","\u786e\u8ba4\u5bc6\u7801"],["confirmPasswordError",""],["nz-button","","nzType","default",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"]],template:function(t,e){if(1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"h2",1),n._uU(2,"\u6b22\u8fce\u767b\u5f55"),n.qZA(),n.TgZ(3,"nz-radio-group",2),n.NdJ("ngModelChange",function(g){return e.loginType=g}),n.TgZ(4,"label",3),n._uU(5,"\u8d26\u53f7\u5bc6\u7801\u767b\u5f55"),n.qZA(),n.TgZ(6,"label",4),n._uU(7,"\u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u5f55"),n.qZA(),n.qZA(),n.TgZ(8,"div",5),n.TgZ(9,"form",6),n.NdJ("ngSubmit",function(){return e.onSubmit()}),n.TgZ(10,"nz-form-item"),n.TgZ(11,"nz-form-control",7),n.TgZ(12,"nz-input-group",8),n._UZ(13,"input",9),n.qZA(),n.YNc(14,L,1,1,"ng-template",null,10,n.W1O),n.qZA(),n.qZA(),n.TgZ(16,"nz-form-item"),n.TgZ(17,"nz-form-control",7),n.TgZ(18,"nz-input-group",11),n._UZ(19,"input",12),n.qZA(),n.YNc(20,J,1,1,"ng-template",null,13,n.W1O),n.qZA(),n.qZA(),n.TgZ(22,"button",14),n._uU(23," \u767b\u5f55 "),n.qZA(),n.qZA(),n.TgZ(24,"form",6),n.NdJ("ngSubmit",function(){return e.onSmsSubmit()}),n.TgZ(25,"nz-form-item"),n.TgZ(26,"nz-form-control",7),n.TgZ(27,"nz-input-group",15),n._UZ(28,"input",16),n.qZA(),n.YNc(29,q,2,2,"ng-template",null,17,n.W1O),n.qZA(),n.qZA(),n.TgZ(31,"nz-form-item"),n.TgZ(32,"nz-form-control",7),n.TgZ(33,"nz-input-group",18),n._UZ(34,"input",19),n.TgZ(35,"button",20),n.NdJ("click",function(){return e.sendSmsCode()}),n._uU(36),n.qZA(),n.qZA(),n.YNc(37,M,1,1,"ng-template",null,21,n.W1O),n.qZA(),n.qZA(),n.TgZ(39,"button",22),n._uU(40," \u767b\u5f55 "),n.qZA(),n.qZA(),n.TgZ(41,"button",23),n.NdJ("click",function(){return e.registerIfy.open()}),n._uU(42," \u6ca1\u6709\u8d26\u53f7\uff1f\u70b9\u51fb\u6ce8\u518c "),n.qZA(),n.TgZ(43,"button",24),n.NdJ("click",function(){return e.guestLogin()}),n._uU(44," \u6e38\u5ba2\u4f53\u9a8c "),n.qZA(),n.qZA(),n.qZA(),n._UZ(45,"xj-loading",25),n.TgZ(46,"nz-modal",26),n.NdJ("nzVisibleChange",function(g){return e.registerIfy.visible=g})("nzOnCancel",function(){return e.registerIfy.close()}),n.YNc(47,G,26,5,"ng-container",27),n.YNc(48,j,4,1,"ng-template",null,28,n.W1O),n.qZA()),2&t){const i=n.MAs(15),g=n.MAs(21),l=n.MAs(30),_=n.MAs(38),d=n.MAs(49);n.xp6(3),n.Q6J("ngModel",e.loginType),n.xp6(6),n.Q6J("formGroup",e.loginForm)("hidden","sms"===e.loginType),n.xp6(2),n.Q6J("nzErrorTip",i),n.xp6(6),n.Q6J("nzErrorTip",g),n.xp6(5),n.Q6J("disabled",!e.loginForm.valid),n.xp6(2),n.Q6J("formGroup",e.smsLoginForm)("hidden","account"===e.loginType),n.xp6(2),n.Q6J("nzErrorTip",l),n.xp6(6),n.Q6J("nzErrorTip",_),n.xp6(3),n.Q6J("disabled",e.countdown>0),n.xp6(1),n.hij(" ",e.countdown>0?e.countdown+"\u79d2\u540e\u91cd\u8bd5":"\u83b7\u53d6\u9a8c\u8bc1\u7801"," "),n.xp6(3),n.Q6J("disabled",!e.smsLoginForm.valid),n.xp6(6),n.Q6J("loading",e.loading)("loadingText",e.loadingText),n.xp6(1),n.Q6J("nzVisible",e.registerIfy.visible)("nzTitle",e.registerIfy.title)("nzFooter",d)}},directives:[a.Dg,s.JJ,s.On,a.Of,a.Bq,s._Y,s.JL,c.Lr,s.sg,C.SK,c.Nx,C.t3,c.Fd,m.gB,A.w,m.Zp,s.Fj,s.u,z.ix,y.dQ,B.N,p.du,p.Hf,h.O5],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column;background-image:url(7.1.f744c753c5b23f13aa4c.jpeg);background-size:cover;background-position:center;background-repeat:no-repeat}.login-container[_ngcontent-%COMP%]   .login-title[_ngcontent-%COMP%]{font-size:36px;font-weight:bold;color:#6973b8;margin-bottom:24px}.login-container[_ngcontent-%COMP%]   .login-form[_ngcontent-%COMP%]{width:400px;padding:24px;background:#6974b885;color:#6974b885;border-radius:8px;box-shadow:0 2px 8px #00000026}.login-container[_ngcontent-%COMP%]   .login-form-forgot[_ngcontent-%COMP%]{float:right}.login-container[_ngcontent-%COMP%]   .login-form-button[_ngcontent-%COMP%]{width:100%}.login-container[_ngcontent-%COMP%]   .login-button[_ngcontent-%COMP%]{background-color:#6973b8;color:#fff}.login-container[_ngcontent-%COMP%]   .guest-login-button[_ngcontent-%COMP%]{background-color:#f0f0f0;color:#666;border:1px dashed #ccc}.login-container[_ngcontent-%COMP%]   .guest-login-button[_ngcontent-%COMP%]:hover{background-color:#6974b852;border-color:#fff;color:#fff}"]}),o})();var X=u(2746),K=u(9017);const R=[{path:"",component:H}];let nn=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[[h.ez,T.Bz.forChild(R),s.UX,c.U5,m.o7,z.sL,X.wm,p.Qp,K.I,a.aF,s.u5]]}),o})()}}]);