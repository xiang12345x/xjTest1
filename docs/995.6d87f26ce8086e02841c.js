"use strict";(self.webpackChunkmini_program=self.webpackChunkmini_program||[]).push([[995],{1995:(_,v,o)=>{o.r(v),o.d(v,{CameraModule:()=>x});var g=o(8583),h=o(8239),t=o(7716),u=o(4453),C=o(9374),m=o(4514);const l=["videoElement"],p=["canvasElement"];function c(a,d){if(1&a&&(t.TgZ(0,"div",9),t._UZ(1,"img",10),t.qZA()),2&a){const n=t.oxw();t.xp6(1),t.Q6J("src",n.photoUrl,t.LSH)}}let s=(()=>{class a{constructor(){this.photoUrl=null,this.stream=null}ngOnInit(){}ngOnDestroy(){this.stopCamera()}startCamera(){var n=this;return(0,h.Z)(function*(){try{n.stream=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1}),n.videoElement.nativeElement.srcObject=n.stream}catch(e){console.error("\u6444\u50cf\u5934\u8bbf\u95ee\u5931\u8d25:",e),alert("\u65e0\u6cd5\u8bbf\u95ee\u6444\u50cf\u5934\uff0c\u8bf7\u68c0\u67e5\u6743\u9650\u8bbe\u7f6e")}})()}stopCamera(){this.stream&&(this.stream.getTracks().forEach(n=>n.stop()),this.videoElement.nativeElement.srcObject=null,this.stream=null)}capture(){if(!this.stream)return;const n=this.videoElement.nativeElement,e=this.canvasElement.nativeElement;e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0,e.width,e.height),this.photoUrl=e.toDataURL("image/png")}print(){window.print()}}return a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["xj-camera"]],viewQuery:function(n,e){if(1&n&&(t.Gf(l,5),t.Gf(p,5)),2&n){let r;t.iGM(r=t.CRH())&&(e.videoElement=r.first),t.iGM(r=t.CRH())&&(e.canvasElement=r.first)}},decls:15,vars:1,consts:[["nz-button","","nzType","primary",3,"click"],[1,"camera-container"],["autoplay","","playsinline",""],["videoElement",""],[2,"display","none"],["canvasElement",""],[1,"controls"],["nz-button","","nzType","default",3,"click"],["class","preview",4,"ngIf"],[1,"preview"],["alt","\u62cd\u6444\u7684\u7167\u7247",3,"src"]],template:function(n,e){1&n&&(t.TgZ(0,"button",0),t.NdJ("click",function(){return e.print()}),t._uU(1,"\u6253\u5f00\u6d4f\u89c8\u5668\u7684\u6253\u5370\u6a21\u5f0f"),t.qZA(),t.TgZ(2,"div",1),t._UZ(3,"video",2,3),t._UZ(5,"canvas",4,5),t.TgZ(7,"div",6),t.TgZ(8,"button",0),t.NdJ("click",function(){return e.startCamera()}),t._uU(9,"\u6253\u5f00\u6444\u50cf\u5934"),t.qZA(),t.TgZ(10,"button",7),t.NdJ("click",function(){return e.stopCamera()}),t._uU(11,"\u5173\u95ed\u6444\u50cf\u5934"),t.qZA(),t.TgZ(12,"button",0),t.NdJ("click",function(){return e.capture()}),t._uU(13,"\u62cd\u7167"),t.qZA(),t.qZA(),t.YNc(14,c,2,1,"div",8),t.qZA()),2&n&&(t.xp6(14),t.Q6J("ngIf",e.photoUrl))},directives:[u.ix,C.dQ,m.w,g.O5],styles:[".camera-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;grid-gap:20px;gap:20px}.camera-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;max-width:640px;background:#000;border-radius:8px}.camera-container[_ngcontent-%COMP%]   .controls[_ngcontent-%COMP%]{display:flex;grid-gap:10px;gap:10px}.camera-container[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]{margin-top:20px}.camera-container[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:300px;border-radius:8px;box-shadow:0 4px 8px #0000001a}"]}),a})();var i=o(4655);const f=[{path:"",component:s}];let x=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[g.ez,i.Bz.forChild(f),u.sL]]}),a})()},8239:(_,v,o)=>{function g(t,u,C,m,l,p,c){try{var s=t[p](c),i=s.value}catch(f){return void C(f)}s.done?u(i):Promise.resolve(i).then(m,l)}function h(t){return function(){var u=this,C=arguments;return new Promise(function(m,l){var p=t.apply(u,C);function c(i){g(p,m,l,c,s,"next",i)}function s(i){g(p,m,l,c,s,"throw",i)}c(void 0)})}}o.d(v,{Z:()=>h})}}]);