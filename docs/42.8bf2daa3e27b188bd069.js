"use strict";(self.webpackChunkmini_program=self.webpackChunkmini_program||[]).push([[42],{2042:(G,f,i)=>{i.r(f),i.d(f,{LoginModule:()=>w});var _=i(8583),l=i(665),n=i(7716),T=i(9075),C=i(8058),d=i(4655),Z=i(1841);let v=(()=>{class o{constructor(t){this.http=t}login(t){return this.http.post("http://localhost:3000/api/login",t)}register(t){return this.http.post("http://localhost:3000/api/register",t)}}return o.\u0275fac=function(t){return new(t||o)(n.LFG(Z.eN))},o.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var u=i(5887),h=i(6704),c=i(7674),b=i(4514),z=i(4453),x=i(9374),y=i(1594),m=i(8542);function F(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u7528\u6237\u540d "),n.BQk())}function I(o,r){1&o&&n.YNc(0,F,2,0,"ng-container",18),2&o&&n.Q6J("ngIf",r.$implicit.hasError("required"))}function A(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u5bc6\u7801 "),n.BQk())}function L(o,r){1&o&&n.YNc(0,A,2,0,"ng-container",18),2&o&&n.Q6J("ngIf",r.$implicit.hasError("required"))}function B(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u7528\u6237\u540d "),n.BQk())}function M(o,r){1&o&&n.YNc(0,B,2,0,"ng-container",18),2&o&&n.Q6J("ngIf",r.$implicit.hasError("required"))}function J(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u8f93\u5165\u5bc6\u7801 "),n.BQk())}function O(o,r){1&o&&n.YNc(0,J,2,0,"ng-container",18),2&o&&n.Q6J("ngIf",r.$implicit.hasError("required"))}function k(o,r){1&o&&(n.ynx(0),n._uU(1," \u8bf7\u786e\u8ba4\u5bc6\u7801 "),n.BQk())}function E(o,r){1&o&&(n.ynx(0),n._uU(1," \u4e24\u6b21\u5bc6\u7801\u8f93\u5165\u4e0d\u4e00\u81f4 "),n.BQk())}function N(o,r){if(1&o&&(n.YNc(0,k,2,0,"ng-container",18),n.YNc(1,E,2,0,"ng-container",18)),2&o){const t=r.$implicit;n.Q6J("ngIf",t.hasError("required")),n.xp6(1),n.Q6J("ngIf",t.hasError("notSame"))}}function Q(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"form",19),n.TgZ(2,"nz-form-item"),n.TgZ(3,"nz-form-control",4),n.TgZ(4,"nz-input-group",5),n._UZ(5,"input",6),n.qZA(),n.YNc(6,M,1,1,"ng-template",null,20,n.W1O),n.qZA(),n.qZA(),n.TgZ(8,"nz-form-item"),n.TgZ(9,"nz-form-control",4),n.TgZ(10,"nz-input-group",8),n._UZ(11,"input",9),n.qZA(),n.YNc(12,O,1,1,"ng-template",null,21,n.W1O),n.qZA(),n.qZA(),n.TgZ(14,"nz-form-item"),n.TgZ(15,"nz-form-control",4),n.TgZ(16,"nz-input-group",22),n._UZ(17,"input",23),n.qZA(),n.YNc(18,N,2,2,"ng-template",null,24,n.W1O),n.qZA(),n.qZA(),n.qZA(),n.BQk()),2&o){const t=n.MAs(7),e=n.MAs(13),g=n.MAs(19),s=n.oxw();n.xp6(1),n.Q6J("formGroup",s.registerIfy.registerForm),n.xp6(2),n.Q6J("nzErrorTip",t),n.xp6(6),n.Q6J("nzErrorTip",e),n.xp6(6),n.Q6J("nzErrorTip",g)}}function P(o,r){if(1&o){const t=n.EpF();n.TgZ(0,"button",25),n.NdJ("click",function(){return n.CHM(t),n.oxw().registerIfy.close()}),n._uU(1,"\u53d6\u6d88"),n.qZA(),n.TgZ(2,"button",26),n.NdJ("click",function(){return n.CHM(t),n.oxw().registerIfy.save()}),n._uU(3," \u6ce8\u518c "),n.qZA()}if(2&o){const t=n.oxw();n.xp6(2),n.Q6J("disabled",!t.registerIfy.registerForm.valid)}}let S=(()=>{class o{constructor(t,e,g,s,a){this.fb=t,this.titleService=e,this.message=g,this.router=s,this.loginService=a,this.loading=!1,this.loadingText="\u767b\u5f55\u4e2d...",this.registerIfy={visible:!1,title:"\u7528\u6237\u6ce8\u518c",registerForm:this.fb.group({username:["",l.kI.required],password:["",l.kI.required],confirmPassword:["",[l.kI.required,this.passwordMatchValidator]]}),open:()=>{this.registerIfy.visible=!0,this.loadingText="\u6ce8\u518c\u4e2d...",this.registerIfy.registerForm.reset({})},close:()=>{this.loadingText="\u767b\u5f55\u4e2d...",this.registerIfy.visible=!1},save:()=>{if(this.registerIfy.registerForm.valid){this.loading=!0;const{username:D,password:V}=this.registerIfy.registerForm.value;this.loginService.register({username:D,password:V}).subscribe(p=>{this.loading=!1,p.success?(this.message.success(p.message),this.registerIfy.close()):this.message.error(p.message)})}}},this.loginForm=this.fb.group({username:["",l.kI.required],password:["",l.kI.required]})}passwordMatchValidator(t){var e,g;return(null===(g=null===(e=t.parent)||void 0===e?void 0:e.get("password"))||void 0===g?void 0:g.value)===t.value?null:{notSame:!0}}onSubmit(){if(this.loading=!0,this.loginForm.valid){const t=this.loginForm.getRawValue();this.loginService.login(t).subscribe(e=>{this.loading=!1,e.success?(localStorage.setItem("token",e.token),this.router.navigate(["/welcome"]).then(g=>{g||console.error("\u5bfc\u822a\u5230/welcome\u5931\u8d25")})):this.message.error(e.message)})}}guestLogin(){this.loading=!0,this.loadingText="\u6b63\u5728\u8fdb\u5165\u6e38\u5ba2\u6a21\u5f0f...",localStorage.setItem("token","guest"),localStorage.setItem("userInfo",JSON.stringify({username:"\u6e38\u5ba2",role:"guest"})),localStorage.setItem("isGuest","true"),this.router.navigate(["/welcome"])}ngOnInit(){this.titleService.setTitle("\u767b\u5f55\u9875\u9762-\u6b22\u8fce\u8bbf\u95ee")}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(l.qu),n.Y36(T.Dx),n.Y36(C.dD),n.Y36(d.F0),n.Y36(v))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-login"]],decls:28,vars:9,consts:[[1,"login-container"],[1,"login-title"],[1,"login-form"],["nz-form","",3,"formGroup","ngSubmit"],[3,"nzErrorTip"],["nzPrefixIcon","user"],["type","text","nz-input","","formControlName","username","placeholder","\u7528\u6237\u540d"],["usernameErrorTpl",""],["nzPrefixIcon","lock"],["type","password","nz-input","","formControlName","password","placeholder","\u5bc6\u7801"],["passwordErrorTpl",""],["nz-button","","nzType","default","nzBlock","",1,"login-button",3,"disabled"],["nz-button","","nzType","default","nzBlock","",1,"login-button",2,"margin-top","10px",3,"click"],["nz-button","","nzType","dashed","nzBlock","",1,"guest-login-button",2,"margin-top","10px",3,"click"],[3,"loading","loadingText"],[3,"nzVisible","nzTitle","nzFooter","nzVisibleChange","nzOnCancel"],[4,"nzModalContent"],["modalFooter",""],[4,"ngIf"],["nz-form","",3,"formGroup"],["registerUsernameError",""],["registerPasswordError",""],["nzPrefixIcon","safety"],["type","password","nz-input","","formControlName","confirmPassword","placeholder","\u786e\u8ba4\u5bc6\u7801"],["confirmPasswordError",""],["nz-button","","nzType","default",3,"click"],["nz-button","","nzType","primary",3,"disabled","click"]],template:function(t,e){if(1&t&&(n.TgZ(0,"div",0),n.TgZ(1,"h2",1),n._uU(2,"\u7528\u6237\u767b\u5f55"),n.qZA(),n.TgZ(3,"div",2),n.TgZ(4,"form",3),n.NdJ("ngSubmit",function(){return e.onSubmit()}),n.TgZ(5,"nz-form-item"),n.TgZ(6,"nz-form-control",4),n.TgZ(7,"nz-input-group",5),n._UZ(8,"input",6),n.qZA(),n.YNc(9,I,1,1,"ng-template",null,7,n.W1O),n.qZA(),n.qZA(),n.TgZ(11,"nz-form-item"),n.TgZ(12,"nz-form-control",4),n.TgZ(13,"nz-input-group",8),n._UZ(14,"input",9),n.qZA(),n.YNc(15,L,1,1,"ng-template",null,10,n.W1O),n.qZA(),n.qZA(),n.TgZ(17,"button",11),n._uU(18," \u767b\u5f55 "),n.qZA(),n.qZA(),n.TgZ(19,"button",12),n.NdJ("click",function(){return e.registerIfy.open()}),n._uU(20," \u6ca1\u6709\u8d26\u53f7\uff1f\u70b9\u51fb\u6ce8\u518c "),n.qZA(),n.TgZ(21,"button",13),n.NdJ("click",function(){return e.guestLogin()}),n._uU(22," \u6e38\u5ba2\u4f53\u9a8c "),n.qZA(),n.qZA(),n.qZA(),n._UZ(23,"xj-loading",14),n.TgZ(24,"nz-modal",15),n.NdJ("nzVisibleChange",function(s){return e.registerIfy.visible=s})("nzOnCancel",function(){return e.registerIfy.close()}),n.YNc(25,Q,20,4,"ng-container",16),n.YNc(26,P,4,1,"ng-template",null,17,n.W1O),n.qZA()),2&t){const g=n.MAs(10),s=n.MAs(16),a=n.MAs(27);n.xp6(4),n.Q6J("formGroup",e.loginForm),n.xp6(2),n.Q6J("nzErrorTip",g),n.xp6(6),n.Q6J("nzErrorTip",s),n.xp6(5),n.Q6J("disabled",!e.loginForm.valid),n.xp6(6),n.Q6J("loading",e.loading)("loadingText",e.loadingText),n.xp6(1),n.Q6J("nzVisible",e.registerIfy.visible)("nzTitle",e.registerIfy.title)("nzFooter",a)}},directives:[l._Y,l.JL,u.Lr,l.sg,h.SK,u.Nx,h.t3,u.Fd,c.gB,b.w,c.Zp,l.Fj,l.JJ,l.u,z.ix,x.dQ,y.N,m.du,m.Hf,_.O5],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;flex-direction:column;background-image:url(7.1.f744c753c5b23f13aa4c.jpeg);background-size:cover;background-position:center;background-repeat:no-repeat}.login-container[_ngcontent-%COMP%]   .login-title[_ngcontent-%COMP%]{font-size:36px;font-weight:bold;color:#6973b8;margin-bottom:24px}.login-container[_ngcontent-%COMP%]   .login-form[_ngcontent-%COMP%]{width:400px;padding:24px;background:#6974b885;color:#6974b885;border-radius:8px;box-shadow:0 2px 8px #00000026}.login-container[_ngcontent-%COMP%]   .login-form-forgot[_ngcontent-%COMP%]{float:right}.login-container[_ngcontent-%COMP%]   .login-form-button[_ngcontent-%COMP%]{width:100%}.login-container[_ngcontent-%COMP%]   .login-button[_ngcontent-%COMP%]{background-color:#6973b8;color:#fff}.login-container[_ngcontent-%COMP%]   .guest-login-button[_ngcontent-%COMP%]{background-color:#f0f0f0;color:#666;border:1px dashed #ccc}.login-container[_ngcontent-%COMP%]   .guest-login-button[_ngcontent-%COMP%]:hover{background-color:#6974b852;border-color:#fff;color:#fff}"]}),o})();var U=i(2746),Y=i(9017);const q=[{path:"",component:S}];let w=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[[_.ez,d.Bz.forChild(q),l.UX,u.U5,c.o7,z.sL,U.wm,m.Qp,Y.I]]}),o})()}}]);